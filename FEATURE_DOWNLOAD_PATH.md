# âœ… ì™„ë£Œ: ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ ê²½ë¡œ ì„¤ì • ê¸°ëŠ¥

## ğŸ¯ ì¶”ê°€ëœ ê¸°ëŠ¥

### 1. ê¸°ë³¸ ê²½ë¡œ ì„¤ì • â­
```
ì˜ˆì‹œ: C:\Users\ì‚¬ìš©ì\Documents\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨
```

### 2. ê±°ë˜ì²˜ë³„ í•˜ìœ„ í´ë” ìë™ ìƒì„± â­
```
êµ¬ì¡°: ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨/ê±°ë˜ì²˜ëª…/ì—°ë„/íŒŒì¼ëª…

ì˜ˆì‹œ:
ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨/
â”œâ”€ ì‚¼ì„±ì „ì/
â”‚  â”œâ”€ 2024/
â”‚  â”‚  â”œâ”€ ì‚¼ì„±ì „ì_2024ë…„12ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
â”‚  â”‚  â””â”€ ì‚¼ì„±ì „ì_2024ë…„12ì›”_ê¸‰ì—¬ëª…ì„¸ì„œ_í™ê¸¸ë™.pdf
â”‚  â””â”€ 2025/
â”‚     â”œâ”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
â”‚     â””â”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
â””â”€ LGì „ì/
   â””â”€ 2025/
      â””â”€ LGì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
```

---

## ğŸ“ í´ë” êµ¬ì¡° ì˜µì…˜

### ì˜µì…˜ 1: ê±°ë˜ì²˜ë³„ í•˜ìœ„ í´ë” ì‚¬ìš© (ê¸°ë³¸) âœ…
```
ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨/
â””â”€ ì‚¼ì„±ì „ì/
   â””â”€ 2025/
      â”œâ”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
      â”œâ”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
      â””â”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëª…ì„¸ì„œ_í™ê¸¸ë™.pdf
```

**ì¥ì **:
- ê±°ë˜ì²˜ë³„ë¡œ ê¹”ë”í•˜ê²Œ ì •ë¦¬
- ì—°ë„ë³„ë¡œ ìë™ ë¶„ë¥˜
- íŒŒì¼ ì°¾ê¸° ì‰¬ì›€

### ì˜µì…˜ 2: í•˜ìœ„ í´ë” ì—†ì´ í•œ ê³³ì— ëª¨ìŒ
```
ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨/
â”œâ”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
â”œâ”€ ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
â”œâ”€ LGì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
â””â”€ LGì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
```

**ì¥ì **:
- ë‹¨ìˆœí•œ êµ¬ì¡°
- ëª¨ë“  íŒŒì¼ í•œëˆˆì— ë³´ì„

---

## ğŸ› ï¸ ì„¤ì • ë°©ë²•

### 1. AppSettings ëª¨ë¸ (ì €ì¥ë¨)
```dart
AppSettings(
  serverUrl: 'http://localhost:8000',
  downloadBasePath: 'C:\\Users\\ì‚¬ìš©ì\\Documents\\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨',
  useClientSubfolders: true, // ê±°ë˜ì²˜ë³„ í•˜ìœ„ í´ë” ì‚¬ìš©
)
```

### 2. ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´
- íŒŒì¼ ì €ì¥ ì‹œë§ˆë‹¤ **ì €ì¥ ìœ„ì¹˜ ì„ íƒ ì°½**ì´ ëœ¸
- ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒ í•„ìš”

### 3. ì„¤ì •í•˜ë©´
- ìë™ìœ¼ë¡œ **ì •í•´ì§„ ê²½ë¡œì— ì €ì¥**
- í´ë”ê°€ ì—†ìœ¼ë©´ **ìë™ ìƒì„±**
- ì €ì¥ í›„ **íƒìƒ‰ê¸°ë¡œ ìë™ ì—´ë¦¼** (Windows)

---

## ğŸ’» í”Œë«í¼ë³„ ê¸°ë³¸ ê²½ë¡œ

### Windows
```
C:\Users\ì‚¬ìš©ì\Documents\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨
```

### macOS
```
/Users/ì‚¬ìš©ì/Documents/ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨
```

### Linux
```
/home/ì‚¬ìš©ì/Documents/ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨
```

---

## ğŸ“ íŒŒì¼ëª… ìë™ ìƒì„± ê·œì¹™

### CSV ê¸‰ì—¬ëŒ€ì¥
```
{ê±°ë˜ì²˜ëª…}_{ì—°ë„}ë…„{ì›”}ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
ì˜ˆ: ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
```

### PDF ê¸‰ì—¬ëŒ€ì¥
```
{ê±°ë˜ì²˜ëª…}_{ì—°ë„}ë…„{ì›”}ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
ì˜ˆ: ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.pdf
```

### PDF ê¸‰ì—¬ëª…ì„¸ì„œ
```
{ê±°ë˜ì²˜ëª…}_{ì—°ë„}ë…„{ì›”}ì›”_{ì§ì›ëª…}_ê¸‰ì—¬ëª…ì„¸ì„œ.pdf
ì˜ˆ: ì‚¼ì„±ì „ì_2025ë…„01ì›”_í™ê¸¸ë™_ê¸‰ì—¬ëª…ì„¸ì„œ.pdf
```

### íŒŒì¼ëª… ì •ë¦¬ ê·œì¹™
- íŠ¹ìˆ˜ë¬¸ì (`< > : " / \ | ? *`) â†’ ì–¸ë”ìŠ¤ì½”ì–´(`_`)ë¡œ ë³€ê²½
- ê³µë°± â†’ ì–¸ë”ìŠ¤ì½”ì–´(`_`)ë¡œ ë³€ê²½
- ì—°ì†ëœ ì–¸ë”ìŠ¤ì½”ì–´ â†’ í•˜ë‚˜ë¡œ í•©ì¹¨

---

## ğŸ”§ êµ¬í˜„ ë‚´ìš©

### 1. AppSettings ëª¨ë¸ í™•ì¥
```dart
class AppSettings {
  final String serverUrl;
  final String apiKey;
  final String downloadBasePath;        // âœ¨ NEW!
  final bool useClientSubfolders;       // âœ¨ NEW!
  
  // ê¸°ë³¸ê°’
  downloadBasePath: '',                 // ë¹ˆ ë¬¸ìì—´ = ìˆ˜ë™ ì„ íƒ
  useClientSubfolders: true,            // ê¸°ë³¸ì€ í•˜ìœ„ í´ë” ì‚¬ìš©
}
```

### 2. PathHelper ìœ í‹¸ë¦¬í‹° (ìƒˆ íŒŒì¼)
```dart
// lib/utils/path_helper.dart

class PathHelper {
  // ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ ê²½ë¡œ
  static String getDefaultDownloadPath();
  
  // ê±°ë˜ì²˜ë³„ í´ë” ê²½ë¡œ
  static String getClientFolderPath({
    required String basePath,
    required String clientName,
    required int year,
  });
  
  // ì „ì²´ íŒŒì¼ ê²½ë¡œ ìƒì„±
  static String getFilePath({
    required String basePath,
    required String clientName,
    required int year,
    required int month,
    required String fileType, // 'csv', 'pdf_register', 'pdf_payslip'
    String? workerName,
    bool useClientSubfolders,
  });
  
  // í´ë” ìë™ ìƒì„±
  static Future<Directory> ensureDirectoryExists(String path);
  
  // íŒŒì¼ëª… ì •ë¦¬
  static String _sanitizeFileName(String fileName);
}
```

### 3. FileEmailService ì—…ë°ì´íŠ¸
```dart
static Future<File> exportPayrollCsv({
  required String clientName,
  required int year,
  required int month,
  required List<SalaryResult> results,
  String? customBasePath,              // âœ¨ NEW!
  bool useClientSubfolders = true,     // âœ¨ NEW!
}) async {
  if (customBasePath != null && customBasePath.isNotEmpty) {
    // ì„¤ì •ëœ ê²½ë¡œ ì‚¬ìš© â†’ ìë™ ì €ì¥
    final filePath = PathHelper.getFilePath(...);
    await PathHelper.ensureDirectoryExists(directory.path);
  } else {
    // ê²½ë¡œ ì—†ìŒ â†’ íŒŒì¼ ì„ íƒ ì°½
    final outputPath = await FilePicker.platform.saveFile(...);
  }
}
```

---

## ğŸ“Š ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ê²½ë¡œ ì„¤ì • ì—†ì´ (ê¸°ì¡´ ë°©ì‹)
```dart
await FileEmailService.exportPayrollCsv(
  clientName: 'ì‚¼ì„±ì „ì',
  year: 2025,
  month: 1,
  results: results,
);
// â†’ íŒŒì¼ ì„ íƒ ì°½ì´ ëœ¸ (ë§¤ë²ˆ ì„ íƒ)
```

### ì˜ˆì‹œ 2: ê²½ë¡œ ì„¤ì • í›„ (ìë™ ì €ì¥)
```dart
await FileEmailService.exportPayrollCsv(
  clientName: 'ì‚¼ì„±ì „ì',
  year: 2025,
  month: 1,
  results: results,
  customBasePath: 'C:\\Documents\\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨',
  useClientSubfolders: true,
);
// â†’ ìë™ ì €ì¥: C:\Documents\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨\ì‚¼ì„±ì „ì\2025\ì‚¼ì„±ì „ì_2025ë…„01ì›”_ê¸‰ì—¬ëŒ€ì¥.csv
// â†’ íƒìƒ‰ê¸° ìë™ ì—´ë¦¼
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (TODO)

### 1. ì„¤ì • UI ì¶”ê°€ â³
```dart
// ì„¤ì • í™”ë©´ì— ì¶”ê°€ í•„ìš”:
- ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ ê²½ë¡œ ì…ë ¥ í•„ë“œ
- í´ë” ì„ íƒ ë²„íŠ¼ (FolderPicker)
- ê±°ë˜ì²˜ë³„ í•˜ìœ„ í´ë” ì‚¬ìš© ì²´í¬ë°•ìŠ¤
- ê²½ë¡œ ì´ˆê¸°í™” ë²„íŠ¼
```

### 2. ë‚˜ë¨¸ì§€ export í•¨ìˆ˜ ì—…ë°ì´íŠ¸ â³
```dart
// ì—…ë°ì´íŠ¸ í•„ìš”:
- exportPayrollRegisterPdf()  // PDF ê¸‰ì—¬ëŒ€ì¥
- generatePayslipPdf()         // PDF ê¸‰ì—¬ëª…ì„¸ì„œ
- generateAllPdfs()            // ì¼ê´„ PDF ìƒì„±
- generateExcelTemplate()      // Excel í…œí”Œë¦¿
```

### 3. AppProvider ì—°ë™ â³
```dart
// app_provider.dartì—ì„œ:
- settings.downloadBasePath ì½ì–´ì˜¤ê¸°
- export í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ê²½ë¡œ ì „ë‹¬
```

### 4. ë¡œì»¬ ì €ì¥ì†Œ ì—°ë™ â³
```dart
// shared_preferences ì‚¬ìš©:
- downloadBasePath ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
- useClientSubfolders ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
```

---

## âœ… ì™„ë£Œëœ ì‘ì—…

- [x] AppSettings ëª¨ë¸ì— downloadBasePath, useClientSubfolders ì¶”ê°€
- [x] PathHelper ìœ í‹¸ë¦¬í‹° ìƒì„± (ê²½ë¡œ ê´€ë¦¬)
- [x] exportPayrollCsv() í•¨ìˆ˜ì— ê²½ë¡œ ì„¤ì • ì§€ì›
- [x] í´ë” ìë™ ìƒì„± ê¸°ëŠ¥
- [x] íŒŒì¼ëª… ìë™ ìƒì„± ë° ì •ë¦¬
- [x] í¬ë¡œìŠ¤ í”Œë«í¼ ì§€ì› (Windows/macOS/Linux)

---

## ğŸ”— Git ì •ë³´

**Commit**: `86e440f`  
**Branch**: `genspark_ai_developer`  
**Pull Request**: https://github.com/Durantax/payroll/pull/1 âœ…

---

## ğŸ’¡ í•µì‹¬ ìš”ì•½

**ê¸°ë³¸ ê²½ë¡œ ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ!**

1. âœ… **ì„¤ì • ê°€ëŠ¥**: `C:\Documents\ê¸‰ì—¬ê´€ë¦¬í”„ë¡œê·¸ë¨`
2. âœ… **ìë™ í´ë” ìƒì„±**: `ê±°ë˜ì²˜ëª…/ì—°ë„/`
3. âœ… **íŒŒì¼ëª… ìë™ ìƒì„±**: `ê±°ë˜ì²˜_ì—°ë„ì›”_ì¢…ë¥˜.í™•ì¥ì`
4. â³ **UI ì¶”ê°€ í•„ìš”**: ì„¤ì • í™”ë©´ì—ì„œ ê²½ë¡œ ì„ íƒ

**ë‹¤ìŒ**: ì„¤ì • UI ë§Œë“¤ê³ , ë‚˜ë¨¸ì§€ export í•¨ìˆ˜ ì—…ë°ì´íŠ¸! ğŸš€
